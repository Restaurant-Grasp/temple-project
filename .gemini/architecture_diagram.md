# ðŸ“Š Frontend File Relationship Diagram
**Special Occasions Module - Complete Architecture**

---

## ðŸ—‚ï¸ File Structure & Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND ARCHITECTURE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CORE FILES (Always Loaded)                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  temple2/js/core/                                                       â”‚
â”‚  â”œâ”€â”€ api.js              â† TempleAPI wrapper (FIXED TODAY)            â”‚
â”‚  â”‚   â””â”€â”€ Methods: get(), post(), put(), delete()                      â”‚
â”‚  â”‚   â””â”€â”€ getBaseUrl() â† Used by all API calls                         â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€â”€ router.js           â† Page routing                                â”‚
â”‚  â”‚   â””â”€â”€ Loads correct page based on URL                              â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â””â”€â”€ utils.js            â† TempleCore utilities                        â”‚
â”‚      â””â”€â”€ showToast(), showLoading(), formatDate()                      â”‚
â”‚                                                                         â”‚
â”‚  temple2/config/                                                        â”‚
â”‚  â””â”€â”€ app.config.js       â† APP_CONFIG constants                        â”‚
â”‚      â””â”€â”€ STORAGE.ACCESS_TOKEN â† Used for auth                          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SPECIAL OCCASIONS MODULE                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  temple2/js/pages/special-occasions/                                    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. master.js (Event Management)                                  â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Create/Edit Events                                        â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Enable Relocation Checkbox (Line 1445)                    â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Enable Table Assignment Checkbox                          â”‚  â”‚
â”‚  â”‚    â””â”€â”€ Table Layout Configuration                                â”‚  â”‚
â”‚  â”‚         â””â”€â”€ API: POST /special-occasions                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. index.js (Booking List & Relocation)                          â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Display all bookings in DataTable                         â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Show ðŸ”„ icon if enable_relocation=true (Line 634)        â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Relocation Modal (Line 294)                               â”‚  â”‚
â”‚  â”‚    â”‚   â”œâ”€â”€ Current seat display                                  â”‚  â”‚
â”‚  â”‚    â”‚   â”œâ”€â”€ New seat input fields                                 â”‚  â”‚
â”‚  â”‚    â”‚   â”œâ”€â”€ Reason textarea                                       â”‚  â”‚
â”‚  â”‚    â”‚   â””â”€â”€ Admin confirmation checkbox                           â”‚  â”‚
â”‚  â”‚    â””â”€â”€ API Calls:                                                 â”‚  â”‚
â”‚  â”‚        â”œâ”€â”€ GET  /special-occasion-bookings (load list)           â”‚  â”‚
â”‚  â”‚        â””â”€â”€ POST /special-occasion-bookings/{id}/relocate         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 3. relocation-report.js (Reports) âœ… FIXED TODAY                 â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Filter Section                                            â”‚  â”‚
â”‚  â”‚    â”‚   â”œâ”€â”€ Event dropdown (Line 554)                             â”‚  â”‚
â”‚  â”‚    â”‚   â”œâ”€â”€ Admin dropdown (Line 578) â† FIXED                     â”‚  â”‚
â”‚  â”‚    â”‚   â”œâ”€â”€ Date range pickers                                    â”‚  â”‚
â”‚  â”‚    â”‚   â””â”€â”€ Action type filter                                    â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ DataTable Display (Line 655)                              â”‚  â”‚
â”‚  â”‚    â”‚   â””â”€â”€ Shows all relocation history                          â”‚  â”‚
â”‚  â”‚    â””â”€â”€ Export Functions                                          â”‚  â”‚
â”‚  â”‚        â”œâ”€â”€ exportToPDF() (Line 772) â† FIXED                      â”‚  â”‚
â”‚  â”‚        â””â”€â”€ exportToExcel() (Line 858) â† FIXED                    â”‚  â”‚
â”‚  â”‚    â””â”€â”€ API Calls:                                                 â”‚  â”‚
â”‚  â”‚        â”œâ”€â”€ GET /special-occasion-bookings/relocation-log         â”‚  â”‚
â”‚  â”‚        â””â”€â”€ GET /reports/relocation-report?format=pdf             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 4. create.js (New Booking Creation)                              â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Booking form                                              â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Seat selection (if table assignment enabled)              â”‚  â”‚
â”‚  â”‚    â””â”€â”€ API: POST /special-occasion-bookings                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5. services.js (Addon Services)                                  â”‚  â”‚
â”‚  â”‚    â””â”€â”€ Manage additional services for bookings                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 6. report.js (General Reports)                                   â”‚  â”‚
â”‚  â”‚    â””â”€â”€ Other booking reports                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND API CONTROLLERS                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  temple3/app/Http/Controllers/                                          â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SpecialOccasionController.php                                    â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Create/Update Events                                      â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Validate enable_relocation                                â”‚  â”‚
â”‚  â”‚    â””â”€â”€ Validate table_layouts                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SpecialOccasionBookingController.php                             â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ relocateBooking() - Relocate single booking               â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ swapBookings() - Swap two bookings                        â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ createRelocationLog() - Log all changes                   â”‚  â”‚
â”‚  â”‚    â””â”€â”€ transformBookingForResponse() - Format data               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ RelocationReportController.php âœ… FIXED TODAY                    â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ generateRelocationReport() - Main report                  â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ generatePdfReport() - PDF export                          â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ generateExcelReport() - Excel export                      â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ getRelocationStats() - Statistics                         â”‚  â”‚
â”‚  â”‚    â””â”€â”€ getBookingRelocationHistory() - Single booking history    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ QRCodeController.php âœ… NEW! CREATED TODAY                       â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ generateQRCode() - Generate QR (SVG/PNG/Base64)          â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ verifyQRCode() - Scan & verify QR                        â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ getCurrentSeatAssignment() - Get live seat data          â”‚  â”‚
â”‚  â”‚    â””â”€â”€ generateQRCodeBase64() - For receipt embedding           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATABASE TABLES                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ special_occ_master                                                â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ id                                                         â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ occasion_name_primary                                     â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ enable_relocation (boolean) â† Controls feature           â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ enable_table_assignment (boolean)                         â”‚  â”‚
â”‚  â”‚    â””â”€â”€ table_layouts (jsonb) â† Dynamic table config             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ bookings                                                          â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ id                                                         â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ booking_number                                            â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ booking_type = 'SPECIAL_OCCASIONS'                        â”‚  â”‚
â”‚  â”‚    â””â”€â”€ updated_at â† Changes on relocation                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ booking_meta                                                      â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ booking_id                                                 â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ meta_key (seat_number, table_number, etc.)               â”‚  â”‚
â”‚  â”‚    â””â”€â”€ meta_value â† CURRENT seat info (updated on relocate)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ special_occasion_relocation_history                               â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ id                                                         â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ occasion_id                                                â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ booking_id                                                 â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ old_table_name, old_row_number, old_column_number        â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ new_table_name, new_row_number, new_column_number        â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ action_type (RELOCATE, SWAP, etc.)                        â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ change_reason                                             â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ changed_by (admin user_id)                                â”‚  â”‚
â”‚  â”‚    â””â”€â”€ changed_at â† Timestamp of change                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Data Flow Diagram

### **Complete Relocation Flow**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USER RELOCATES A BOOKING                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. USER ACTION
   â†“
   User clicks ðŸ”„ icon in booking list
   â†“
   
2. FRONTEND (index.js)
   â†“
   Line 753: Load booking data into modal
   â†“
   User fills relocation form:
   - New table/row/column/seat
   - Reason for change
   - Confirms action
   â†“
   Line 796: Submit form
   â†“
   
3. API CALL
   â†“
   POST /api/v1/special-occasion-bookings/{id}/relocate
   Headers:
   - Authorization: Bearer {token}
   - X-Temple-ID: temple1
   Body:
   {
     "new_table_number": "Table 2",
     "new_row_number": 1,
     "new_column_number": 2,
     "new_assign_number": "A2",
     "reason": "Devotee requested",
     "change_type": "manual",
     "admin_confirmation": true
   }
   â†“
   
4. BACKEND (SpecialOccasionBookingController.php)
   â†“
   Line 1936: relocateBooking() method
   â†“
   Validation:
   - Check if relocation enabled
   - Validate new seat availability
   - Require admin confirmation
   â†“
   DB::beginTransaction()
   â†“
   Update booking_meta:
   - seat_number = "A2"
   - table_number = "Table 2"
   - row_number = 1
   - column_number = 2
   â†“
   Update bookings.updated_at = NOW()
   â†“
   Insert into special_occasion_relocation_history:
   - old_seat = "A1"
   - new_seat = "A2"
   - changed_by = current_user_id
   - changed_at = NOW()
   - reason = "Devotee requested"
   â†“
   DB::commit()
   â†“
   
5. RESPONSE
   â†“
   {
     "success": true,
     "message": "Booking relocated successfully",
     "data": {
       "booking_id": "...",
       "new_seat": "A2",
       "relocation_log_id": "..."
     }
   }
   â†“
   
6. FRONTEND UPDATE
   â†“
   index.js receives success response
   â†“
   Show success toast
   â†“
   Reload booking list (shows new seat)
   â†“
   Close modal
   â†“
   
7. REPORT UPDATE
   â†“
   relocation-report.js can now show this change
   â†“
   New row appears in relocation log
   â†“
   
8. QR CODE BEHAVIOR (NEW!)
   â†“
   QR code still contains same encrypted booking_id
   â†“
   When scanned:
   - Calls POST /api/v1/qr/verify
   - Backend queries booking_meta for CURRENT seat
   - Returns "A2" (new seat), not "A1" (old seat)
   - Shows updated_at timestamp
   â†“
   âœ… QR always shows latest seat assignment!
```

---

## ðŸ“± Frontend-Backend Communication

### **API Request Pattern**

```javascript
// All API calls follow this pattern:

// 1. Frontend makes request
TempleAPI.post('/endpoint', data)
    â†“
// 2. api.js adds headers automatically
{
    'Authorization': 'Bearer ' + localStorage.getItem('access_token'),
    'X-Temple-ID': getTempleId(), // From URL
    'Content-Type': 'application/json'
}
    â†“
// 3. Backend receives request
Route::middleware(['temple', 'jwt.auth'])->group(function() {
    Route::post('/endpoint', [Controller::class, 'method']);
});
    â†“
// 4. Controller processes
public function method(Request $request) {
    // Validate
    // Process
    // Return JSON
}
    â†“
// 5. Frontend receives response
.done(function(response) {
    if (response.success) {
        // Handle success
    }
})
.fail(function(error) {
    // Handle error
});
```

---

## ðŸŽ¯ Key File Locations Summary

| Feature | Frontend File | Backend File | Line Numbers |
|---------|--------------|--------------|--------------|
| **Enable Relocation** | master.js | SpecialOccasionController.php | 1445, 169-174 |
| **Relocate Booking** | index.js | SpecialOccasionBookingController.php | 753-796, 1936-2255 |
| **Relocation Report** | relocation-report.js | RelocationReportController.php | 78-856, 33-315 |
| **QR Generation** | (pending) | QRCodeController.php | -, 26-115 |
| **QR Verification** | (pending) | QRCodeController.php | -, 117-185 |

---

## ðŸ”§ Quick Reference

### **To Enable Relocation:**
1. Go to: `/temple1/special-occasions/master`
2. Edit event
3. Check: "Enable Relocation" checkbox
4. Save

### **To Relocate a Booking:**
1. Go to: `/temple1/special-occasions/index`
2. Find booking
3. Click: ðŸ”„ icon
4. Fill form
5. Submit

### **To View Report:**
1. Go to: `/temple1/special-occasions/relocation-report`
2. Apply filters
3. Click: "Export PDF" or "Export Excel"

### **To Generate QR:**
```javascript
// API call (backend ready, frontend pending)
GET /api/v1/qr/booking/{bookingId}?format=svg
```

---

*This diagram shows the complete architecture and data flow!* ðŸŽ¯
